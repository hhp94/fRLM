outcome="outcome", # string, the variable name of the outcome
time = "age" # string, the variable name of the time at which measures were taken
)
grid
K
range
degree
devtools::load_all(".")
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
time = "age" # string, the variable name of the time at which measures were taken
)
tobs_mat
lapply(tobs_mat, function(tt) length(tt))
lapply(tobs_mat, function(tt) length(tt)) %>% unlist() %>% table()
lapply(tobs_mat, function(tt) length(tt)) %>% unlist() %>% table()
get_splines(tobs_mat[[1]])
get_splines(tobs_mat[[1]], 4)
devtools::load_all(".")
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
time = "age" # string, the variable name of the time at which measures were taken
)
t_obs
exposure
devtools::load_all(".")
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
time = "age" # string, the variable name of the time at which measures were taken
)
tobs
data_split
data_split[[1]]
data_split[[1]][time]
data_split[[1]][time] %>% as.vector()
data_split[[1]][time] %>% unlist()
data_split[[1]][time] %>% unlist() %>% as.vector
t_obs
t_obs[[1]]
devtools::load_all(".")
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
time = "age" # string, the variable name of the time at which measures were taken
)
tobs
xobs
devtools::load_all(".")
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
time = "age" # string, the variable name of the time at which measures were taken
)
source("C:/Users/Willwhite/Documents/Github/fRLM/R/fRLM_lpfr.R", echo=TRUE)
devtools::load_all(".")
rm(fRLM_lpfr())
rm(fRLM_lpfr)
devtools::load_all(".")
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
time = "age" # string, the variable name of the time at which measures were taken
)
phi
tobs_mat
# 4) splines:
lp <- lpfr( y, t_obs, xobs = exposure )
tobs_mat
xobs_mat
phi_mat <- apply( tobs_mat, 1, function(tt) get_splines(tt, K )$psi, simplify = F)
is.matrix(tobs_mat)
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
time = "age" # string, the variable name of the time at which measures were taken
)
tobs_mat
is.matrix(tobs_mat)
get_splines(tobs_mat[1,], K)
phi_mat <- apply( tobs_mat, 1, function(tt) get_splines(tt, K )$psi, simplify = F)
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
time = "age" # string, the variable name of the time at which measures were taken
)
phi_mat <- apply( tobs_mat, 1, function(tt) get_splines(tt, K )$psi, simplify = F)
J <- t(psi) %*% phi / length(grid)
# fit:
C <- cbind( rep(1, length(y) ), covariates )  # scalar predictors
dat <- list( n = length(y), L = L, K = K, d = ncol(C), Nmax = Nmax, y = y, C = C, phi_mat = phi_mat,
J = J, Nvec = Nvec, tobs = tobs_mat, xobs = xobs_mat )
compiled_file
if(is.null(compiled_file)){
fit <- rstan::stan( file = "./stan/lpfr.stan", data = dat, ... )
}else{
fit <- rstan::sampling(compiled_file, data = dat, ...)
}
# 4) splines:
lp <- lpfr( y, t_obs, xobs = exposure )
devtools::load_all(".")
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
time = "age" # string, the variable name of the time at which measures were taken
)
# 4) splines:
lp <- lpfr( y, t_obs, xobs = exposure, compiled_file = "C:/Users/Willwhite/Documents/Github/fRLM/inst/stan/lpfr.stan")
# 4) splines:
lp <- lpfr( y, t_obs, xobs = exposure, compiled_file = "C:/Users/Willwhite/Documents/Github/fRLM/inst/stan/lpfr.stan")
library(fRLM)
library(dplyr)
data(toy)
toy2 <- toy
toy2[, 4] <- round( ( toy[, 4] - 10 ) / 30, 2 ) # i. rescale age:
y <- toy2 %>% group_by(id) %>% summarise(outcome = mean(outcome) ) %>% pull(outcome) # extract outcome:
t_obs <- toy2 %>% group_by(id) %>% summarise(age = list(age)) %>%  pull(age) # extract age
exposure <- toy2 %>% group_by(id) %>% summarise(exposure = list(exposure)) %>%  pull(exposure) # extract exposure
# 4) splines:
lp <- lpfr( y, t_obs, xobs = exposure, compiled_file = "C:/Users/Willwhite/Documents/Github/fRLM/inst/stan/lpfr.stan")
library(fRLM)
library(dplyr)
# 1) Setup data:
data(toy)
toy2 <- toy
toy2[, 4] <- round( ( toy[, 4] - 10 ) / 30, 2 ) # i. rescale age:
y <- toy2 %>% group_by(id) %>% summarise(outcome = mean(outcome) ) %>% pull(outcome) # extract outcome:
t_obs <- toy2 %>% group_by(id) %>% summarise(age = list(age)) %>%  pull(age) # extract age
exposure <- toy2 %>% group_by(id) %>% summarise(exposure = list(exposure)) %>%  pull(exposure) # extract exposure
# 2) run lpfr
lp <- lpfr( y, t_obs, xobs = exposure, compiled_file = "./inst/stan/lpfr.stan")
library(dplyr)
devtools::load_all(".")
devtools::load_all(".")
library(dplyr)
library(fRLM)
library(dplyr)
# 1) Setup data:
data(toy)
toy2 <- toy
toy2[, 4] <- round( ( toy[, 4] - 10 ) / 30, 2 ) # i. rescale age:
y <- toy2 %>% group_by(id) %>% summarise(outcome = mean(outcome) ) %>% pull(outcome) # extract outcome:
t_obs <- toy2 %>% group_by(id) %>% summarise(age = list(age)) %>%  pull(age) # extract age
exposure <- toy2 %>% group_by(id) %>% summarise(exposure = list(exposure)) %>%  pull(exposure) # extract exposure
toy2$outcome <- rbinom(len(toy2$outcome), 1, 1/(1+exp(-toy2$outcome)))
toy2$outcome <- rbinom(length(toy2$outcome), 1, 1/(1+exp(-toy2$outcome)))
toy2$outcome
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
family="binary",
time = "age" # string, the variable name of the time at which measures were taken
)
devtools::load_all()
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
family="binary",
time = "age" # string, the variable name of the time at which measures were taken
)
padding
library(fRLM)
padding
devtools::load_all()
library(fRLM)
library(dplyr)
# 1) Setup data:
data(toy)
toy2 <- toy
toy2[, 4] <- round( ( toy[, 4] - 10 ) / 30, 2 ) # i. rescale age:
y <- toy2 %>% group_by(id) %>% summarise(outcome = mean(outcome) ) %>% pull(outcome) # extract outcome:
t_obs <- toy2 %>% group_by(id) %>% summarise(age = list(age)) %>%  pull(age) # extract age
exposure <- toy2 %>% group_by(id) %>% summarise(exposure = list(exposure)) %>%  pull(exposure) # extract exposure
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
time = "age" # string, the variable name of the time at which measures were taken
)
devtools::load_all()
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
time = "age" # string, the variable name of the time at which measures were taken
)
devtools::load_all()
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
time = "age" # string, the variable name of the time at which measures were taken
)
devtools::load_all()
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
time = "age" # string, the variable name of the time at which measures were taken
)
lapply(list_of_vec, length()) %>% unlist %>% length
Nmax <- lapply(list_of_vec, function(x) length(x)) %>% unlist %>% length
Nmax
Nmax <- lapply(list_of_vec, function(x) length(x)) %>% unlist %>% max
Nmax
devtools::load_all()
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
time = "age" # string, the variable name of the time at which measures were taken
)
tobs$mask
devtools::load_all()
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
time = "age" # string, the variable name of the time at which measures were taken
)
tobs$padded
tobs$mask
devtools::load_all()
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
time = "age" # string, the variable name of the time at which measures were taken
)
devtools::load_all()
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
time = "age" # string, the variable name of the time at which measures were taken
)
phi
psi
devtools::load_all()
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
time = "age" # string, the variable name of the time at which measures were taken
)
devtools::load_all()
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
time = "age" # string, the variable name of the time at which measures were taken
)
devtools::load_all()
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
time = "age" # string, the variable name of the time at which measures were taken
)
devtools::load_all()
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
time = "age" # string, the variable name of the time at which measures were taken
)
devtools::load_all()
devtools::load_all()
library(fRLM)
library(dplyr)
# 1) Setup data:
data(toy)
toy2 <- toy
toy2[, 4] <- round( ( toy[, 4] - 10 ) / 30, 2 ) # i. rescale age:
y <- toy2 %>% group_by(id) %>% summarise(outcome = mean(outcome) ) %>% pull(outcome) # extract outcome:
t_obs <- toy2 %>% group_by(id) %>% summarise(age = list(age)) %>%  pull(age) # extract age
exposure <- toy2 %>% group_by(id) %>% summarise(exposure = list(exposure)) %>%  pull(exposure) # extract exposure
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
family="binary",
time = "age" # string, the variable name of the time at which measures were taken
)
devtools::load_all()
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
family="binary",
time = "age" # string, the variable name of the time at which measures were taken
)
devtools::load_all()
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
family="binary",
time = "age" # string, the variable name of the time at which measures were taken
)
# padding with mask
padding <- function(list_of_vec) {
# Function to pad a single vector and create its mask
pad_and_mask <- function(x) {
pad_length <- Nmax - length(x)
padded <- c(x, rep(0, pad_length))
mask <- c(rep(0, length(x)), rep(1, pad_length))
list(padded = padded, mask = mask)
}
# Apply the function to each vector in the list
results <- lapply(list_of_vec, pad_and_mask)
# Combine the padded vectors and masks
padded_matrix <- do.call(rbind, lapply(results, `[[`, "padded"))
mask_matrix <- do.call(rbind, lapply(results, `[[`, "mask"))
list(mat = padded_matrix, mask = mask_matrix)
}
devtools::load_all()
# padding with mask
padding <- function(list_of_vec) {
# Function to pad a single vector and create its mask
pad_and_mask <- function(x) {
pad_length <- Nmax - length(x)
padded <- c(x, rep(0, pad_length))
mask <- c(rep(0, length(x)), rep(1, pad_length))
list(padded = padded, mask = mask)
}
# Apply the function to each vector in the list
results <- lapply(list_of_vec, pad_and_mask)
# Combine the padded vectors and masks
padded_matrix <- do.call(rbind, lapply(results, `[[`, "padded"))
mask_matrix <- do.call(rbind, lapply(results, `[[`, "mask"))
list(mat = padded_matrix, mask = mask_matrix)
}
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
family="binary",
time = "age" # string, the variable name of the time at which measures were taken
)
library(fRLM)
roxygen2::roxygenize()
library(fRLM)
devtools::load_all()
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
family="binary",
time = "age" # string, the variable name of the time at which measures were taken
)
devtools::load_all()
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
family="binary",
time = "age" # string, the variable name of the time at which measures were taken
)
devtools::load_all()
roxygen2::roxygenize()
fit <- fRLM_lpfr(data = toy,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
family="binary",
time = "age" # string, the variable name of the time at which measures were taken
)
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
devtools::load_all()
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
devtools::load_all()
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
devtools::load_all()
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
devtools::load_all()
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
padding
devtools::load_all()
padding
devtools::document()
library(fRLM)
padding
devtools::load_all()
library(fRLM)
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
devtools::load_all()
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
devtools::load_all()
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
padding
devtools::load_all()
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
padding
devtools::load_all()
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
Nvec
# Create the Nvec list TODO: use the mask instead
Nvec <- lapply(1:nrow(tobs$mask), function(i)sum(tobs$mask[i,]==0))
Nvec
devtools::load_all()
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
devtools::load_all()
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
devtools::load_all()
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
devtools::load_all()
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
n = length(y)
length(y)
L
K
ncol(C)
devtools::load_all()
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
C
ncol(C)
Nmax
y
C
phi_mat
J
Nvec
tobs$mat
xobs$mat
devtools::load_all()
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
devtools::load_all()
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
stan_file
fit <- rstan::stan( file = stan_file, data = dat, ... )
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
toy2$outcome <- rbinom(length(toy2$outcome), 1, 1/(1+exp(-toy2$outcome)))
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
library(fRLM)
library(dplyr)
# 1) Setup data:
data(toy)
# toy2 <- toy
# toy2[, 4] <- round( ( toy[, 4] - 10 ) / 30, 2 ) # i. rescale age:
# y <- toy2 %>% group_by(id) %>% summarise(outcome = mean(outcome) ) %>% pull(outcome) # extract outcome:
# t_obs <- toy2 %>% group_by(id) %>% summarise(age = list(age)) %>%  pull(age) # extract age
# exposure <- toy2 %>% group_by(id) %>% summarise(exposure = list(exposure)) %>%  pull(exposure) # extract exposure
# # 2) run lpfr
# lp <- lpfr( y, t_obs, xobs = exposure, compiled_file = "./inst/stan/lpfr.stan")
#
# fit <- fRLM_lpfr(data = toy,
#           id="id",  # string, name of the subject identifier
#           exposures = "exposure", # string, the variable name of the exposures (for now, one)
#           outcome="outcome", # string, the variable name of the outcome
#           time = "age" # string, the variable name of the time at which measures were taken
#           )
#
# # Binary outcome
toy2$outcome <- rbinom(length(toy2$outcome), 1, 1/(1+exp(-toy2$outcome)))
toy2
toy2
# 1) Setup data:
data(toy)
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
library(fRLM)
library(dplyr)
# 1) Setup data:
data(toy)
library(fRLM)
library(dplyr)
# 1) Setup data:
data(toy)
toy$outcome <- rbinom(length(toy2$outcome), 1, 1/(1+exp(-toy2$outcome)))
fit <- fRLM_lpfr(data = toy2,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
family="binary",
time = "age" # string, the variable name of the time at which measures were taken
)
devtools::load_all()
fit <- fRLM_lpfr(data = toy2,
id="id",  # string, name of the subject identifier
exposures = "exposure", # string, the variable name of the exposures (for now, one)
outcome="outcome", # string, the variable name of the outcome
family="binary",
time = "age" # string, the variable name of the time at which measures were taken
)
source("C:/Users/Willwhite/Documents/Github/fRLM/development/lpfr/minimal_example.R", echo=TRUE)
library(fRLM)
library(dplyr)
# 1) Setup data:
data(toy)
# fit <- fRLM_lpfr(data = toy,
#           id="id",  # string, name of the subject identifier
#           exposures = "exposure", # string, the variable name of the exposures (for now, one)
#           outcome="outcome", # string, the variable name of the outcome
#           time = "age" # string, the variable name of the time at which measures were taken
#           )
# Binary outcome ---
toy$outcome <- rbinom(length(toy2$outcome), 1, 1/(1+exp(-toy2$outcome)))
