---
title: "modding"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{modding}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Example
```{r}
library(rstan)
library(fRLM)
options(mc.cores = 4)

# Gaussian outcome
debug(fRLM_lpfr)

fit <- fRLM_lpfr(
  data = toy,
  id = "id",
  # string, name of the subject identifier
  exposures = "exposure",
  # string, the variable name of the exposures (for now, one)
  outcome = "outcome",
  # string, the variable name of the outcome
  time = "age",
  # string, the variable name of the time at which measures were taken
  warmup = 500,
  iter = 1000,
  chains = 4
)

undebug(fRLM_lpfr)

plot(fit)
w = predict(fit)
```

```{r}
rstan::extract(fit$fit)$xi |> class()
rstan::extract(fit$fit)$xi |> head()
```

```{r}
library(cmdstanr)
cmdstanr_example("schools")
```

```{r}
library(cmdstanr)
debug(fRLM_lpfr1)
fit1 <- fRLM_lpfr1(
  data = toy,
  id = "id",
  # string, name of the subject identifier
  exposures = "exposure",
  # string, the variable name of the exposures (for now, one)
  outcome = "outcome",
  # string, the variable name of the outcome
  time = "age",
  # string, the variable name of the time at which measures were taken
  sample_args = list(
    refresh = 100,
    parallel_chains = 4,
    iter_warmup = 1000,
    iter_sampling = 1000
  )
)
undebug(fRLM_lpfr1)
```

```{r}
plot(fit1)
```
